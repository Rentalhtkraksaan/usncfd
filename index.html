<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Input Data Anggota Klub</title>
<style>
/* === GLOBAL === */
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;color:#333;display:flex;justify-content:center;align-items:center;min-height:100vh;overflow:hidden;position:relative}
#bg-video{position:fixed;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:-1}
.wrapper{width:100%;height:100vh;display:flex;justify-content:center;align-items:center;overflow-y:auto;padding:20px}
.container{max-width:600px;width:100%;background:rgba(255,255,255,0.75);padding:30px;border-radius:20px;box-shadow:0 4px 8px rgba(0,0,0,0.1);z-index:1}
h1{text-align:center;color:#007bff;margin-bottom:20px}
.form-group{margin-bottom:20px}
label{display:block;margin-bottom:8px;font-weight:600;color:#555}
input[type=text],input[type=number]{width:100%;padding:10px;border:1px solid #ccc;border-radius:5px;background:rgba(255,255,255,0.7);color:#000;transition:border-color .3s}
input[type=text]:focus,input[type=number]:focus{border-color:#007bff;outline:none}
.date-info{text-align:center;font-size:1.1em;color:#dc3545;margin-bottom:20px}
.catalogs{margin-top:15px;max-height:40vh;overflow-y:auto;padding-right:15px}
.catalog-item{background:rgba(249,249,249,0.75);border:1px solid #ddd;border-radius:8px;padding:20px;margin-bottom:20px;position:relative;animation:fadeIn .5s}
.remove-btn{position:absolute;top:10px;right:10px;background:rgba(220,53,69,0.85);color:#fff;border:none;border-radius:50%;width:24px;height:24px;font-size:14px;cursor:pointer}
.button-group{display:flex;justify-content:space-between;margin-top:20px}
.add-btn,.send-btn{padding:12px 25px;cursor:pointer;border:none;color:#fff;border-radius:5px;font-size:16px;font-weight:600;transition:.3s}
.add-btn{background:rgba(40,167,69,0.85)}
.add-btn:hover{background:rgba(33,136,56,0.85)}
.send-btn{background:rgba(0,123,255,0.85);width:100%;margin-top:20px}
.send-btn:hover{background:rgba(0,86,179,0.85)}
#formStatus{text-align:center;margin-top:20px;font-size:1.2em;color:#28a745;font-weight:bold;display:none}
@keyframes fadeIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
@media(max-width:400px){.container{padding:20px}h1{font-size:1.5em}.form-group label{font-size:.9em}input[type=text],input[type=number]{font-size:.9em;padding:8px}.catalog-item{padding:15px}}
</style>
</head>
<body>
<video id="bg-video" autoplay muted loop playsinline preload="auto">
    <source src="nadia.mp4" type="video/mp4">
</video>

<div class="wrapper">
    <div class="container">
        <h1>Input Data Barang Anggota CWU</h1>
        <div class="date-info">Tanggal Acara: <span id="tanggalAcara">Tidak ditemukan</span></div>

        <form id="clubForm" style="display:none;">
            <div class="form-group">
                <label for="namaLengkap">Nama Lengkap:</label>
                <input type="text" id="namaLengkap" required>
            </div>

            <h2>Katalog Produk</h2>
            <div id="catalogs" class="catalogs">
                <div class="catalog-item">
                    <button type="button" class="remove-btn" onclick="this.parentElement.remove()">×</button>
                    <div class="form-group">
                        <label>Nama Produk:</label>
                        <input type="text" class="namaProduk" required>
                    </div>
                    <div class="form-group">
                        <label>Jumlah Unit:</label>
                        <input type="number" class="jumlahUnit" required min="1" value="1">
                    </div>
                    <div class="form-group">
                        <label>Harga Satuan:</label>
                        <input type="number" class="hargaSatuan" required min="0" value="0">
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button type="button" class="add-btn" id="addCatalogBtn">Tambah Katalog</button>
            </div>

            <button type="submit" class="send-btn">Kirim Data</button>
        </form>
        
        <div id="formStatus"></div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
<script>
const firebaseConfig = {
    apiKey: "AIzaSyDpPEkKbEt6b_v2OWlBfGuaVQpBg2-RWR4",
    authDomain: "cwu-gen-2.firebaseapp.com",
    databaseURL: "https://cwu-gen-2-default-rtdb.firebaseio.com",
    projectId: "cwu-gen-2",
    storageBucket: "cwu-gen-2.appspot.com",
    messagingSenderId: "40585612014",
    appId: "1:40585612014:web:c88141fee369aca68181ff"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const configRef = db.ref('konfigurasi/');
const form = document.getElementById('clubForm');
const statusEl = document.getElementById('formStatus');
const dateEl = document.getElementById('tanggalAcara');
const catalogs = document.getElementById('catalogs');

configRef.on('value', (snap) => {
    const cfg = snap.val();
    const active = cfg && cfg.formStatus !== undefined ? cfg.formStatus : true;
    if(active){
        if(cfg && cfg.tanggalAcara){
            dateEl.textContent = cfg.tanggalAcara;
            form.style.display = 'block';
            statusEl.style.display = 'none';
        } else {
            dateEl.textContent = "Tanggal belum diatur.";
            form.style.display = 'none';
            statusEl.style.display = 'block';
            statusEl.textContent = "Maaf, formulir belum dibuka oleh PJ.";
        }
    } else {
        form.style.display = 'none';
        statusEl.style.display = 'block';
        statusEl.textContent = "Formulir sedang dinonaktifkan.";
    }
});

document.getElementById('addCatalogBtn').addEventListener('click', ()=>{
    const item = document.createElement('div');
    item.className='catalog-item';
    item.innerHTML=`
        <button type="button" class="remove-btn" onclick="this.parentElement.remove()">×</button>
        <div class="form-group"><label>Nama Produk:</label><input type="text" class="namaProduk" required></div>
        <div class="form-group"><label>Jumlah Unit:</label><input type="number" class="jumlahUnit" required min="1" value="1"></div>
        <div class="form-group"><label>Harga Satuan:</label><input type="number" class="hargaSatuan" required min="0" value="0"></div>`;
    catalogs.appendChild(item);
});

form.addEventListener('submit', e=>{
    e.preventDefault();
    const data = {
        namaLengkap: document.getElementById('namaLengkap').value,
        tanggal: dateEl.textContent,
        katalogProduk: []
    };
    document.querySelectorAll('.catalog-item').forEach(item=>{
        data.katalogProduk.push({
            namaProduk: item.querySelector('.namaProduk').value,
            jumlahUnit: parseInt(item.querySelector('.jumlahUnit').value),
            hargaSatuan: parseInt(item.querySelector('.hargaSatuan').value)
        });
    });
    db.ref('dataAnggota/').push(data).then(()=>{
        form.style.display='none';
        statusEl.style.display='block';
        statusEl.textContent='Data berhasil dikirim!';
    }).catch(err=>alert('Kesalahan: '+err.message));
});
</script>
</body>
</html>
